[function(){const v=e=>document.querySelector(e),m=e=>document.querySelectorAll(e);console.log.bind(console);const s=(e,t)=>{v(e).insertAdjacentHTML("beforeend",t)},f={css:{},cellSize:40,cellMargin:10,ArrowLeft:"a",ArrowRight:"d",ArrowUp:"w",ArrowDown:"s",dataMatrix:[[2,2,2,2],[4,4,4,4],[2,2,2,2],[4,4,4,4]],enableNewNum:!0,moved:!1};window.dataMatrix=f.dataMatrix;const e=()=>{var e=f.dataMatrix;let t="";e.forEach((e,a)=>{let l="";e.forEach((e,t)=>{0!=e&&(t=`<div class="f-cell f-cell-num-${e} f-cell-poi-${t}-${a} tile tile-${e} tile-new" data-num="${e}"><div class="tile-inner">${e}</div></div>`,l+=t)}),t+=l}),s(".tile-container",t)};const h=(e,t)=>{var a=`.f-cell-poi-${e}-`+t;return 0!=m(a).length||0==e?[e,t]:h(e-1,t)},u=(e,t)=>{var a=`.f-cell-poi-${e}-`+t;return 0!=m(a).length||3==e?[e,t]:u(e+1,t)},g=(e,t)=>{var a=`.f-cell-poi-${e}-`+t;return 0!=m(a).length||0==t?[e,t]:g(e,t-1)},M=(e,t)=>{var a=`.f-cell-poi-${e}-`+t;return 0!=m(a).length||3==t?[e,t]:M(e,t+1)},L=(e,t,a)=>{var l=t[0],t=t[1];let i="";i=a?`<div class="tile tile-${e} tile-new f-cell f-cell-num-${e} f-cell-poi-${l}-${t}" data-num="${e}">
<div class="tile-inner">${e}</div></div>`:`<div class="tile tile-${e} f-cell f-cell-num-${e} f-cell-merge f-cell-poi-${l}-${t}" data-num="${e}">
<div class="tile-inner">${e}</div></div>`,s(".tile-container",i)},a=(e,t)=>Math.round(Math.random()*(t-e))+e,t=()=>{let l=[];return f.dataMatrix.forEach((e,a)=>{e.forEach((e,t)=>{0==e&&l.push([a,t])})}),l};let l=0;const r=e=>{var e=e[a(0,e.length-1)],t=.5<Math.random()?2:4;f.dataMatrix[e[0]][e[1]]=t,L(t,[e[1],e[0]],"nomerge"),l+=1},x=()=>{f.moved=!0},n=()=>{let l="";f.dataMatrix.forEach((e,a)=>{e.forEach((e,t)=>{l+=e+"  ";t=`.debug div[data-poi='${t}-${a}']`;v(t).innerText=0==e?"":e}),l+="\n"})},c={a:()=>{for(let l=0;l<4;l++)for(let a=0;a<4;a++){var i=`.f-cell-poi-${a}-`+l,s=m(i);if(0!=s.length){let t=null;if(1<s.length)for(let e=0;e<s.length;e++)s[e].classList.contains("f-cell-merge")?(t=s[e]).classList.remove("f-cell-merge"):s[e].remove();else t=s[0];if(0!=a){var r=t.dataset.num,n=h(a-1,l),c=n[0],n=n[1],o=`.f-cell-poi-${c}-`+n,d=m(o);let e=null;null==(e=0==d.length?null:1==d.length?d[0]:(d=`.f-cell-poi-${c}-${n}.f-cell-merge`,v(d)))?(t.classList.remove(i.slice(1)),t.classList.add(o.slice(1)),t.classList.remove("tile-new"),f.dataMatrix[l][a]=0,f.dataMatrix[n][c]=parseInt(r),x()):e.dataset.num==r?(t.classList.remove(i.slice(1)),t.classList.add(o.slice(1)),t.classList.remove("tile-new"),d=2*parseInt(r),L(d,[c,n]),f.dataMatrix[l][a]=0,f.dataMatrix[n][c]=d,x()):c-a!=-1&&(bx=(c+1)*(f.cellSize+f.cellMargin),t.classList.remove(i.slice(1)),t.classList.add(`f-cell-poi-${c+1}-`+n),t.classList.remove("tile-new"),f.dataMatrix[l][a]=0,f.dataMatrix[n][c+1]=parseInt(r),x())}}}},d:()=>{for(let l=0;l<4;l++)for(let a=3;-1<a;a--){var i=`.f-cell-poi-${a}-`+l,s=m(i);if(0!=s.length){let t=null;if(1<s.length)for(let e=0;e<s.length;e++)s[e].classList.contains("f-cell-merge")?(t=s[e]).classList.remove("f-cell-merge"):s[e].remove();else t=s[0];if(3!=a){var r=t.dataset.num,n=u(a+1,l),c=n[0],n=n[1],o=`.f-cell-poi-${c}-`+n,d=m(o);let e=null;null==(e=0==d.length?null:1==d.length?d[0]:(d=`.f-cell-poi-${c}-${n}.f-cell-merge`,v(d)))?(t.classList.remove(i.slice(1)),t.classList.add(o.slice(1)),t.classList.remove("tile-new"),f.dataMatrix[l][a]=0,f.dataMatrix[n][c]=parseInt(r),x()):e.dataset.num==r?(t.classList.remove(i.slice(1)),t.classList.add(o.slice(1)),t.classList.remove("tile-new"),d=2*parseInt(r),L(d,[c,n]),f.dataMatrix[l][a]=0,f.dataMatrix[n][c]=d,x()):c-a!=1&&(o=c-1,t.classList.remove(i.slice(1)),t.classList.add(`f-cell-poi-${o}-`+n),t.classList.remove("tile-new"),f.dataMatrix[l][a]=0,f.dataMatrix[n][c-1]=parseInt(r),x())}}}},w:()=>{for(let l=0;l<4;l++)for(let a=0;a<4;a++){var i=`.f-cell-poi-${l}-`+a,s=m(i);if(0!=s.length){let t=null;if(1<s.length)for(let e=0;e<s.length;e++){if(s[e].classList.contains("f-cell-merge")){(t=s[e]).classList.remove("f-cell-merge");break}s[e].remove()}else t=s[0];if(0!=a){var r=t.dataset.num,n=g(l,a-1),c=n[0],n=n[1],o=`.f-cell-poi-${c}-`+n,d=m(o);let e=null;null==(e=0==d.length?null:1==d.length?d[0]:(d=`.f-cell-poi-${c}-${n}.f-cell-merge`,v(d)))?(t.classList.remove(i.slice(1)),t.classList.add(o.slice(1)),t.classList.remove("tile-new"),f.dataMatrix[a][l]=0,f.dataMatrix[n][c]=parseInt(r),x()):e.dataset.num==r?(t.classList.remove(i.slice(1)),t.classList.add(o.slice(1)),t.classList.remove("tile-new"),d=2*parseInt(r),L(d,[c,n]),f.dataMatrix[a][l]=0,f.dataMatrix[n][c]=d,x()):n-a!=-1&&(t.classList.remove(i.slice(1)),t.classList.add(`f-cell-poi-${c}-`+(n+1)),t.classList.remove("tile-new"),f.dataMatrix[a][l]=0,f.dataMatrix[n+1][c]=parseInt(r),x())}}}},s:()=>{for(let l=0;l<4;l++)for(let a=3;-1<a;a--){var i=`.f-cell-poi-${l}-`+a,s=m(i);if(0!=s.length){let t=null;if(1<s.length)for(let e=0;e<s.length;e++)s[e].classList.contains("f-cell-merge")?(t=s[e]).classList.remove("f-cell-merge"):s[e].remove();else t=s[0];if(3!=a){var r=t.dataset.num,n=M(l,a+1),c=n[0],n=n[1],o=`.f-cell-poi-${c}-`+n,d=m(o);let e=null;null==(e=0==d.length?null:1==d.length?d[0]:(d=`.f-cell-poi-${c}-${n}.f-cell-merge`,v(d)))?(t.classList.remove(i.slice(1)),t.classList.add(o.slice(1)),t.classList.remove("tile-new"),f.dataMatrix[a][l]=0,f.dataMatrix[n][c]=parseInt(r),x()):e.dataset.num==r?(t.classList.remove(i.slice(1)),t.classList.add(o.slice(1)),t.classList.remove("tile-new"),d=2*parseInt(r),L(d,[c,n]),f.dataMatrix[a][l]=0,f.dataMatrix[n][c]=d,x()):n-a!=1&&(t.classList.remove(i.slice(1)),t.classList.add(`f-cell-poi-${c}-`+(n-1)),t.classList.remove("tile-new"),f.dataMatrix[a][l]=0,f.dataMatrix[n-1][c]=parseInt(r),x())}}}}},i=()=>{window.addEventListener("keydown",e=>{var e=e.key;c[e]?c[e]():f[e]&&c[f[e]](),f.moved&&(e=t(),r(e),n(),f.moved=!1,setTimeout(()=>{d()||(v(".game-message").classList.add("game-over"),v(".game-message p").innerText="Game over!")},0))}),window.navigator.msPointerEnabled?(this.eventTouchstart="MSPointerDown",this.eventTouchmove="MSPointerMove",this.eventTouchend="MSPointerUp"):(this.eventTouchstart="touchstart",this.eventTouchmove="touchmove",this.eventTouchend="touchend");var i,s,e=v(".game-container");e.addEventListener(this.eventTouchstart,function(e){!window.navigator.msPointerEnabled&&1<e.touches.length||1<e.targetTouches||(s=window.navigator.msPointerEnabled?(i=e.pageX,e.pageY):(i=e.touches[0].clientX,e.touches[0].clientY),e.preventDefault())}),e.addEventListener(this.eventTouchmove,function(e){e.preventDefault()}),e.addEventListener(this.eventTouchend,function(e){var t,a,l;!window.navigator.msPointerEnabled&&0<e.touches.length||0<e.targetTouches||(e=window.navigator.msPointerEnabled?(t=e.pageX,e.pageY):(t=e.changedTouches[0].clientX,e.changedTouches[0].clientY),t=t-i,a=Math.abs(t),e=e-s,l=Math.abs(e),10<Math.max(a,l)&&self.emit("move",l<a?0<t?1:3:0<e?2:0))})},o=e=>{var t=e[0],e=e[1];return 0<=t&&t<f.dataMatrix[0].length&&0<=e&&e<f.dataMatrix.length},d=()=>{for(let t=0;t<f.dataMatrix.length;t++)for(let e=0;e<f.dataMatrix[0].length;e++)if(p(e,t))return!0;return t().length},p=(e,t)=>{var a=[e,t-1],l=[e,t+1],i=[e-1,t],s=[e+1,t];return o(a)&&f.dataMatrix[t][e]==f.dataMatrix[a[1]][a[0]]||o(l)&&f.dataMatrix[t][e]==f.dataMatrix[l[1]][l[0]]||o(i)&&f.dataMatrix[t][e]==f.dataMatrix[i[1]][i[0]]||o(s)&&f.dataMatrix[t][e]==f.dataMatrix[s[1]][s[0]]};e(),i()}][0]();